<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ask Questions</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <link rel="shortcut icon" href="images/favicon.png">

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en" rel="stylesheet">
    <link href="icon.css" rel="stylesheet">
    <link rel="stylesheet" href="material.min.css">
    <link rel="stylesheet" href="styles.css">

  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="css/materialize.css">

  <!-- Compiled and minified JavaScript -->

    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
    #addButton {
        position:fixed;
        bottom:16px;
        right:16px;
        z-index:901;
    }
    p {
      line-height:10%;
    }
    </style>
  </head>
  <body>
    <!-- Modal Structure -->
    <div id="modal1" class="modal">
      <div class="modal-content">
        <h4>Provide your email</h4>
        <div class="input-field">
          <input id="email" type="email" class="validate">
          <label for="email" data-error="Incorrect email address" data-success="Correct">Email</label>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#!" onclick="checkLogin()" class="waves-effect waves-green btn-flat">Enter</a>
      </div>
    </div>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
      <header class="demo-header mdl-layout__header mdl-color--grey-100 mdl-color-text--grey-600">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">Home</span>
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
            <label style="bottom: 36px" class="mdl-button mdl-js-button mdl-button--icon" for="search">
              <i class="material-icons">search</i>
            </label>
            <div class="mdl-textfield__expandable-holder">
              <input class="mdl-textfield__input" type="text" id="search">
              <label class="mdl-textfield__label" for="search">Provide a query...</label>
            </div>
          </div>
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" id="hdrbtn">
            <i class="material-icons">more_vert</i>
          </button>
          <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right" for="hdrbtn">
            <li class="mdl-menu__item">About</li>
            <li class="mdl-menu__item">Contact</li>
            <li class="mdl-menu__item">Logout</li>
          </ul>
        </div>
      </header>
      <div class="demo-drawer mdl-layout__drawer mdl-color--blue-grey-900 mdl-color-text--blue-grey-50">
        <header class="demo-drawer-header">
          <img id="avatar" src="images/user.jpg" class="demo-avatar">
          <div class="demo-avatar-dropdown">
            <span id="loginName">hello@example.com</span>
            <div class="mdl-layout-spacer"></div>
            <button id="accbtn" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
              <i class="material-icons" role="presentation">arrow_drop_down</i>
            </button>
            <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="accbtn">
              <li class="mdl-menu__item">View Profile</li>
              <li class="mdl-menu__item">Logout</li>
            </ul>
          </div>
        </header>
        <nav class="demo-navigation mdl-navigation mdl-color--blue-grey-800">
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">General</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">Dutch</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">Math</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">French</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">English</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">History</a>
          <a onclick="switchCourse(this.innerHTML);" class="mdl-navigation__link" href="#">Geography</a>
          <div class="mdl-layout-spacer"></div>
          <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">help_outline</i><span class="visuallyhidden">Help</span></a>
        </nav>
      </div>
      <button id="addButton" onclick="drawNewQuestion()" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored">
        <i class="material-icons">add</i>
      </button>
      <main class="mdl-layout__content mdl-color--grey-100">
        <ul style="width:90%; margin:auto; margin-top:10px;" id="mainul" class="collapsible popout" data-collapsible="accordion">
          <li>
            <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
            <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
          </li>
          <li>
            <div class="collapsible-header"><select>First</div>
            <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
          </li>
          <li>
            <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
            <div class="collapsible-body">
              <p>Lorem ipsum dolor sit amet.</p>
              <div class="collapsible-header"><i class="material-icons">reply</i></div>
              <div><p>tester</p></div>
            </div>
          </li>
        </ul>
      </main>
    </div>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="material.min.js"></script>
    <script src="materialize.min.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/md5.js"></script>
    <script>
      var questions = {
        "General": [{open:true, title:'What time does the library open?', contents: 'I want to study very early because i am a good student. Can I come in at 8 AM?', author:'good@student.be', followup:{title: "Yes!", contents: "The library is open from 7:30 AM, feel free to study from then!", author:"library@personel.be", followup:{title:"Thanks", contents: "Will sure do!", author: "good@student.be"}}}],
        "Math": [],
        "English": [],
        "French": [],
        "Dutch": [],
        "History": [],
        "Geography": [],
      };
      var currentCourse = "General";
      var email = "";
      var addQuestion = function (course, title, contents, author) {
        questions[course].push({open:true, title:title, contents:contents, author:author});
      };
      var addFolowUp = function(course, idx, title, contents, author) {
        var rec = function self(obj) {
          if(obj["followup"]) {
            return self(obj["followup"]);
          } else {
            obj["followup"] = {title:title, content:content, author:author};
            return obj;
          }
        };
        rec(questions[course][idx]);
      };
      var drawQuestions = function (course) {
        var questionhtml = "<li>"+
          "<div class=\"collapsible-header\"><i class=\"material-icons\">ICONPLACEHOLDER</i>TITLEPLACEHOLDER</div>" +
          "<div class=\"collapsible-body\"><p>CONTENTPLACEHOLDER</p><p style=\"font-style:oblique;text-align:right;width:100%;\">AUTHORPLACEHOLDER</p>"+
          "FOLLOWUPPLACEHOLDER</div>" +
          "</li>";
        var followuphtml = "<div class=\"collapsible-header\"><i class=\"material-icons\">reply</i></div>" +
          "<div><p>CONTENTPLACEHOLDER</p><p style=\"margin:0px;font-style:oblique;text-align:right;width:100%;\">AUTHORPLACEHOLDER</p></div>";
        var list = questions[course].reduce(function(lststr, obj, ig, nore) {
          var followuprec = function(obj, res, i) {
            if(i != 0) {
              var str = followuphtml.replace(/TITLEPLACEHOLDER/g, obj.title)
                                    .replace(/CONTENTPLACEHOLDER/g, obj.contents)
                                    .replace(/AUTHORPLACEHOLDER/g, obj.author);
            } else {
              var str = "";
            }
            if(obj["followup"]) {
              return followuprec(obj["followup"], res + str, i + 1);
            } else if(i != 0) {
              return res + str;
            } else {
              return res;
            }
          };
          return lststr + questionhtml.replace(/TITLEPLACEHOLDER/g, obj.title)
                                      .replace(/CONTENTPLACEHOLDER/g, obj.contents)
                                      .replace(/ICONPLACEHOLDER/g, obj.open ? 'question_answer' : 'lock')
                                      .replace(/AUTHORPLACEHOLDER/g, obj.author)
                                      .replace(/FOLLOWUPPLACEHOLDER/g, followuprec(obj, "", 0));
        }, "");
        if(list=="") {
          list = "<br /><br /><center><h4>No Questions for this course yet!</h4>Ask one by pressing the button in the bottom right corner!</center>";
        }
        $("#mainul").html(list);
      };
      var drawNewQuestion = function() {
        $("#questionForm").remove();
        var questionhtml = "<li class=\"\" id=\"questionForm\">"+
          "<div class=\"collapsible-header\"><i class='material-icons'>question_answer</i><div style=\"padding-top:0;padding-bottom:0;\" class=\"mdl-textfield mdl-js-textfield\">" +
          "<input class=\"mdl-textfield__input\" name=\"title\" type=\"text\" id=\"title\">" +
          "<label style=\"top:0;\" class=\"mdl-textfield__label\" for=\"title\">Title</label>" +
          "</div></div>" +
          "<div style=\"margin-left:20px;\" class=\"mdl-textfield mdl-js-textfield\">" +
            "<textarea class=\"mdl-textfield__input\" type=\"text\" name=\"content\" rows=\"5\" id=\"content\" ></textarea>" +
            "<label class=\"mdl-textfield__label\" for=\"content\">Ask a question...</label>" +
          "</div>" +
          "<p style=\"font-style:oblique;text-align:right;width:100%;padding-bottom:15px;padding-right:15px;\">" +
          "<button onclick=\"addQuestionClick()\" class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">Ask!</button></p>" +
          "</li>";
         $("#mainul").prepend(questionhtml);
         componentHandler.upgradeAllRegistered();
         $("#title").focus();
      }
      var switchCourse = function(course) {
        currentCourse = course;
        $("#mainul").html("");
        drawQuestions(currentCourse);
        return false;
      };
      var addQuestionClick = function() {
        // TODO checks
        addQuestion(currentCourse, $("#title").val(), $("#content").val(), email);
        drawQuestions(currentCourse);
      };
      var setEmail = function(lemail) {
        email = lemail;
        $("#loginName").html(email);
        $("#avatar").prop('src', 'http://www.gravatar.com/avatar/' + CryptoJS.MD5(email));
      };
      var checkLogin = function() {
        var isValidEmailAddress= function(emailAddress) {
          var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
          return pattern.test(emailAddress);
        }
        var email = $("#email").val();
        if(isValidEmailAddress(email)) {
          $("#modal1").closeModal();
        }
        setEmail(email);
      };
      var init = function () {
        $('#modal1').openModal({
          dismissible:false,
          opacity:0.8
        });
        drawQuestions(currentCourse);
      };
      init();
    </script>
  </body>
</html>
